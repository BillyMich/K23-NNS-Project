#include "../include/Graph.h"


Graph* initGraph() {
    Graph* graph = (Graph*)malloc(sizeof(Graph));
    if (graph == NULL) {
        fprintf(stderr, "Memory allocation error\n");
        exit(EXIT_FAILURE);
    }
    graph->nodes = NULL;
    graph->numNodes = 0;
    return graph;
}

// Function to free the entire graph
void freeGraph(Graph* graph) {
    if (graph == NULL) return;
    
    Node* current = graph->nodes;
    while (current != NULL) {
        Node* next = current->next;
        freeNode(current);
        current = next;
    }
    free(graph);
}


Graph* createGraphFromBinaryFile(String filename, int dimensions) {
    FILE* file = fopen(filename, "rb");
    if (file == NULL) {
        perror("Error opening file");
        return NULL;
    }

    // Create an empty graph
    Graph* graph = initGraph();
    if (graph == NULL) {
        fclose(file);
        perror("Error creating graph");
        return NULL;
    }

    double coordinate;
    Node** headNode = &graph->nodes; 
    int flag = 0; // Flag for feof  

    // Read and process data from the binary file
    while (!feof(file)) {
        
        Dimension* headDimension = NULL;

        for (int i = 0; i < dimensions; i++){
            fread(&coordinate, sizeof(double), 1, file); // Read one double at a time
            if(feof(file)){
                flag = 1;
                break;
            }
            addDimension(&headDimension, i, coordinate);
        }

        if(flag == 0) {
            addNode(headNode, headDimension);
            graph->numNodes++;
        }
    }

    fclose(file);
    return graph;
}


double findAccurationResult(Graph* graph , Graph* graphRightResults){

    Node * tempNodeKNS = graph->nodes;
    Node * tempNodeRight = graphRightResults->nodes;
    double count = 0 ;
    double correct = 0;

    while (tempNodeKNS != NULL && tempNodeRight!= NULL  )
    {    
        NodeNeighborsLinkedList * tempNodeListKNS = tempNodeKNS->neighbors; 
        NodeNeighborsLinkedList * tempNodeListRight = tempNodeRight->neighbors;

        while (tempNodeListKNS != NULL && tempNodeListRight != NULL )
        {
            count++;
            if (tempNodeListKNS->node->nodeNameInt == tempNodeListRight->node->nodeNameInt) correct++;
            tempNodeListKNS = tempNodeListKNS->next;
            tempNodeListRight = tempNodeListRight->next;
        }
        
        tempNodeKNS = tempNodeKNS->next;
        tempNodeRight = tempNodeRight->next;
    }
    
    return  (correct / count )* 100;
}


void makeFile(String filename){
    FILE* file = fopen(filename, "wb");
    if (file == NULL) {
        perror("Error opening file");
        exit(1);
    }
    
    // double coordinate[] = { 29.68,67.67,82.13,46.52,82.04,47.79,47.14,43.69,35.89,76.47,23.88,48.96,75.02,87.63,43.32,57.61,39.35,59.20,49.04,30.82,68.76,72.90,90.12,96.91,64.38,33.32,70.71,41.72,40.65,72.65,68.82,7.73,99.73,56.35,66.03,78.40,92.54,42.05,29.63,20.33,21.69,1.21,15.26,73.37,29.93,53.52,31.55,36.65,45.10,3.36,60.57,17.89,95.08,37.96,26.72,52.75,75.87,72.77,76.60,72.94,5.56,32.05,53.75,81.52,95.84,30.29,7.63,71.48,98.08,53.30,9.41,49.69,37.16,94.10,71.74,75.62,76.16,77.27,33.17,11.07,18.78,73.01,64.06,92.38,68.49,18.40,14.63,22.85,66.75,55.31,89.76,19.42,69.86,58.70,1.24,8.94,55.22,23.85,99.82,28.03,98.92,33.51,90.77,27.53,89.57,49.51,60.25,0.27,51.08,24.08,14.57,30.45,2.50,90.85,36.21,26.45,50.31,72.33,8.54,92.68,41.28,64.80,60.63,51.32,49.34,79.15,26.31,56.16,39.86,10.52,95.36,18.50,8.19,91.84,79.51,38.56,82.66,77.64,29.58,85.28,24.03,78.11,9.63,55.23,72.77,66.24,70.19,2.37,2.22,87.11,9.59,67.25,89.14,48.35,4.42,22.86,25.21,60.45,97.04,52.08,19.83,12.15,88.04,65.01,43.80,42.02,69.87,44.30,95.58,40.00,70.58,72.41,41.11,43.50,22.57,72.55,38.96,17.07,62.37,72.26,76.67,76.21,14.42,27.52,45.07,17.91,98.62,63.60,62.81,57.43,89.63,69.14,36.89,1.81,76.34,73.64,88.96,10.73,98.65,7.32,27.84,78.54,12.10,79.98,98.11,20.04,51.96,41.19,95.45,17.22,39.75,43.22,40.81,91.67,31.46,48.77,82.77,67.35,17.81,41.73,15.66,15.29,25.94,47.45,56.63,72.32,22.70,34.37,2.88,83.20,13.84,82.17,57.81,19.86,46.20,30.91,7.24,74.16,48.66,16.81,52.31,50.83,97.65,55.65,50.46,71.62,64.96,57.18,54.70,71.53,12.55,69.67,87.51,3.59,36.52,47.58,34.17,46.05,13.02,80.03,56.75,23.17,56.48,58.24,22.77,39.28,45.42,15.74,76.39,32.42,20.70,50.59,18.05,58.06,14.64,14.44,47.86,28.79,86.93,34.55,66.45,91.33,40.76,42.18,22.54,89.77,26.81,57.89,80.29,77.56,24.80,16.78,76.76,28.91,53.52,22.99,39.08,58.38,80.49,97.10,96.69,20.72,32.13,19.31,9.09,74.82,0.03,62.06,41.03,1.28,66.24,32.24,57.35,18.52,23.63,44.38,51.72,62.70,46.88,17.29,19.41,19.68,53.85,19.61,38.17,57.17,18.79,95.56,84.53,78.86,59.98,77.09,85.09,35.50,71.47,51.54,84.09,43.22,17.39,3.06,8.88,50.14,66.41,17.00,56.14,89.12,53.70,42.60,97.74,1.10,79.33,43.82,6.16,25.97,76.38,92.51,64.47,54.25,16.28,49.70,98.50,26.19,89.37,94.69,28.11,69.19,71.87,59.10,80.39,33.76,86.16,4.16,52.19,84.83,33.26,24.95,81.95,69.57,91.37,56.00,73.95,76.07,87.10,19.73,8.64,43.93,94.20,45.65,11.83,93.03,20.37,15.20,14.91,26.02,76.22,3.37,45.19,64.91,66.80,88.50,96.00,13.67,11.71,70.77,15.03,10.07,12.24,47.62,5.35,18.30,30.66,78.52,48.09,60.11,31.25,48.33,40.13,4.86,92.59,28.73,46.60,76.78,97.57,39.01,42.20,62.83,77.59,44.22,35.37,99.60,70.25,59.64,84.05,44.94,23.19,23.07,84.77,56.23,8.10,93.67,17.13,0.09,79.50,71.14,82.02,87.29,67.54,29.40,28.61,3.86,30.24,6.09,1.72,93.19,78.74,65.27,22.84,9.31,27.46,44.65,92.92,75.45,51.47,76.21,90.79,68.42,72.62,21.38,84.16,17.15,7.79,36.90,9.90,40.44,52.99,42.47,54.96,3.12,48.80,48.40,28.92,83.23,86.72,73.93,3.84,58.07,9.51,1.49,73.11,94.22,64.98,55.38,29.86,96.91,59.43,58.56,24.48,47.84,7.04,11.43,58.56,77.58,4.07,40.15,81.61,19.54,7.42,74.81,13.93,30.39,43.81,38.76,13.13,18.74,65.66,77.75,8.81,27.63,8.52,32.76,68.37,38.89,78.16,24.29,83.23,85.06,88.37,81.32,47.47,12.93,19.92,96.40,65.49,91.87,4.79,56.89,27.98,13.83,10.72,26.91,9.73,98.49,21.47,67.26,36.00,50.14,97.78,29.28,74.71,16.12,32.04,91.68,47.70,47.65,66.42,25.03,12.66,30.49,81.09,65.70,77.96,61.97,78.05,79.09,39.00,83.06,96.84,31.23,98.05,30.69,10.83,67.62,53.15,27.86,19.68,2.25,84.66,25.39,68.22,40.14,95.68,8.84,76.46,26.65,95.25,58.00,11.44,52.34,78.45,37.16,20.18,42.63,64.33,42.37,15.00,0.48,91.85,62.36,23.59,50.88,15.59,51.64,59.17,45.97,17.85,97.10,8.44,84.01,71.96,89.84,62.38,47.86,12.92,19.23,82.34,50.38,64.43,9.42,86.95,11.40,10.72,36.35,56.53,53.58,98.41,22.78,44.10,50.89,59.90,35.42,30.48,78.58,63.48,18.80,90.71,72.36,30.03,38.62,78.53,50.63,97.89,18.38,5.16,32.63,10.15,2.11,48.81,53.02,51.34,67.52,16.47,62.01,99.40,9.78,74.57,63.23,21.55,64.91,4.06,92.10,43.14,68.73,37.50,98.04,87.76,5.06,7.67,29.49,45.29,50.19,82.75,92.97,8.07,22.76,26.88,91.57,71.79,51.01,25.90,92.82,83.20,75.58,90.71,30.70,5.58,89.18,22.46,33.71,47.83,88.94,23.18,44.41,97.08,75.63,10.16,71.77,15.66,20.71,70.09,95.23,1.38,98.82,19.56,3.54,75.59,24.15,86.65,23.91,84.35,16.10,46.60,66.91,35.05,26.55,92.45,6.37,33.92,38.71,93.71,95.19,94.22,57.43,58.36,33.03,47.31,97.43,50.63,69.85,47.69,61.64,26.00,28.03,61.93,93.85,58.10,43.91,74.94,43.24,11.25,37.37,40.97,29.49,56.02,85.65,58.42,66.41,10.37,41.19,2.85,10.15,82.57,56.40,35.39,83.18,73.05,25.82,92.18,57.94,39.98,71.55,10.03,41.51,58.32,6.74,84.62,43.70,14.97,4.92,0.56,95.86,41.37,89.54,44.27,41.87,75.73,7.53,81.76,68.91,74.47,91.50,95.61,87.76,3.87,13.75,14.41,50.39,64.24,82.69,3.27,60.34,65.16,99.20,52.67,53.53,87.87,69.68,16.12,32.42,81.28,97.23,94.26,71.68,1.35,67.38,72.09,3.95,74.36,41.07,5.63,19.99,64.61,65.05,26.75,47.30,35.87,57.58,22.10,97.80,10.04,4.97,59.41,31.98,84.06,75.19,88.86,89.43,22.79,49.08,37.83,83.67,87.42,12.03,21.07,50.99,23.18,66.46,57.34,80.30,47.59,16.27,90.33,47.04,97.94,99.06,89.60,40.44,61.05,84.47,89.07,10.25,23.65,52.14,28.54,55.08,13.99,84.19,25.06,3.51,55.64,10.71,73.52,83.44,18.90,4.86,79.65,79.58,91.17,33.80,53.35,2.08,0.60,36.56,16.12,96.52,0.98,83.09,17.95,84.67,62.22,75.60,92.08,12.95,36.71,17.13,91.62,53.73,8.45,76.48,47.38,80.91,62.31,25.79,41.40,80.82,90.14,39.21,95.10,26.24,7.25,54.59,83.38,45.81,0.72,91.52,6.81,12.58,15.09,36.96,17.70,99.25,73.28,11.38,99.74,46.56,55.78,81.26,85.43,53.61,62.21,7.05,22.96,84.20,35.09,98.39,22.28,83.85,77.33,71.40,7.85,34.76,39.48,82.02,24.94,38.52,88.92,45.57,55.09,32.47,2.30,65.53,21.49,91.40,12.74,13.98,11.08,97.81,64.83,38.68,71.97,64.97,20.80,38.24,48.46,57.11,87.47,61.80,37.03,29.80,86.18,30.81,52.67,35.13,66.49,3.69,81.90,4.57,95.63,61.14,95.40,22.03,41.10,85.35,39.91,90.63,85.07,4.09,3.95,84.47,39.34,93.51,74.01,0.20,83.13,41.52,71.66,21.16,79.45,17.70,24.75,27.34,83.99,79.10,7.97,51.78,77.20,16.53,80.26,14.97,71.65,34.36  };      
    double coordinate[] = { 1.324000,   2.000000,   1.990000,   4.899000,
                            6.567000,   5.139767,   3.330000,   0.139767,
                            1.467000,   2.278025,   1.670000,   3.278025,
                            9.900000,   5.416209,   7.670000,   4.416209};
    fwrite(coordinate, sizeof(double)*16, 1, file); // Read one double at a time

}

